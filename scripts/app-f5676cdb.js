/*global angular */
angular.module("todomvcSpeedtestAngular",["ngRoute"]).config(["$routeProvider",function(o){"use strict";var e={controller:"TodoCtrl",templateUrl:"app/todo/todo.html",resolve:{store:["localStorage",function(o){return o}]}};o.when("/",e).when("/:status",e).otherwise({redirectTo:"/"})}]),angular.module("todomvcSpeedtestAngular").factory("localStorage",["$q",function(o){"use strict";var e="todos-angularjs",t={todos:[],_getFromLocalStorage:function(){return JSON.parse(localStorage.getItem(e)||"[]")},_saveToLocalStorage:function(o){localStorage.setItem(e,JSON.stringify(o))},clearCompleted:function(){var e=o.defer(),n=[],l=[];return t.todos.forEach(function(o){o.completed?n.push(o):l.push(o)}),angular.copy(l,t.todos),t._saveToLocalStorage(t.todos),e.resolve(t.todos),e.promise},"delete":function(e){var n=o.defer();return t.todos.splice(t.todos.indexOf(e),1),t._saveToLocalStorage(t.todos),n.resolve(t.todos),n.promise},get:function(){var e=o.defer();return angular.copy(t._getFromLocalStorage(),t.todos),e.resolve(t.todos),e.promise},insert:function(e){var n=o.defer();return t.todos.push(e),t._saveToLocalStorage(t.todos),n.resolve(t.todos),n.promise},put:function(e,n){var l=o.defer();return t.todos[n]=e,t._saveToLocalStorage(t.todos),l.resolve(t.todos),l.promise}};return t}]),angular.module("todomvcSpeedtestAngular").directive("todoFocus",["$timeout",function(o){"use strict";return function(e,t,n){e.$watch(n.todoFocus,function(e){e&&o(function(){t[0].focus()},0,!1)})}}]),angular.module("todomvcSpeedtestAngular").directive("todoEscape",function(){"use strict";var o=27;return function(e,t,n){t.bind("keydown",function(t){t.keyCode===o&&e.$apply(n.todoEscape)})}}),angular.module("todomvcSpeedtestAngular").controller("TodoCtrl",["$scope","$route","$filter","localStorage",function(o,e,t,n){"use strict";var l=o.todos=n.todos;o.newTodo="",o.editedTodo=null,o.$watch("todos",function(){o.remainingCount=t("filter")(l,{completed:!1}).length,o.completedCount=l.length-o.remainingCount,o.allChecked=!o.remainingCount},!0),o.$on("$routeChangeSuccess",function(){var t=o.status=e.status||"";o.statusFilter="active"===t?{completed:!1}:"completed"===t?{completed:!0}:null}),o.addTodo=function(){var e={title:o.newTodo.trim(),completed:!1};e.title&&(o.saving=!0,n.insert(e).then(function(){o.newTodo=""}).finally(function(){o.saving=!1}))},o.editTodo=function(e){o.editedTodo=e,o.originalTodo=angular.extend({},e)},o.saveEdits=function(e,t){return"blur"===t&&"submit"===o.saveEvent?void(o.saveEvent=null):(o.saveEvent=t,o.reverted?void(o.reverted=null):(e.title=e.title.trim(),e.title===o.originalTodo.title?void(o.editedTodo=null):void n[e.title?"put":"delete"](e).then(function(){},function(){e.title=o.originalTodo.title}).finally(function(){o.editedTodo=null})))},o.revertEdits=function(e){l[l.indexOf(e)]=o.originalTodo,o.editedTodo=null,o.originalTodo=null,o.reverted=!0},o.removeTodo=function(o){n.delete(o)},o.saveTodo=function(o){n.put(o)},o.toggleCompleted=function(o,e){angular.isDefined(e)&&(o.completed=e),n.put(o,l.indexOf(o)).then(function(){},function(){o.completed=!o.completed})},o.clearCompletedTodos=function(){n.clearCompleted()},o.markAll=function(e){l.forEach(function(t){t.completed!==e&&o.toggleCompleted(t,e)})}}]),angular.module("todomvcSpeedtestAngular").run(["$templateCache",function(o){o.put("app/todo/todo.html",'<section id="todoapp"><header id="header"><h1>todos</h1><form id="todo-form" ng-submit="addTodo()"><input id="new-todo" placeholder="What needs to be done?" ng-model="newTodo" ng-disabled="saving" autofocus=""></form></header><section id="main" ng-show="todos.length" ng-cloak=""><input id="toggle-all" type="checkbox" ng-model="allChecked" ng-click="markAll(allChecked)"> <label for="toggle-all">Mark all as complete</label><ul id="todo-list"><li ng-repeat="todo in todos | filter:statusFilter track by $index" ng-class="{completed: todo.completed, editing: todo == editedTodo}"><div class="view"><input class="toggle" type="checkbox" ng-model="todo.completed" ng-change="toggleCompleted(todo)"> <label ng-dblclick="editTodo(todo)">{{todo.title}}</label> <button class="destroy" ng-click="removeTodo(todo)"></button></div><form ng-submit="saveEdits(todo, \'submit\')"><input class="edit" ng-trim="false" ng-model="todo.title" todo-escape="revertEdits(todo)" ng-blur="saveEdits(todo, \'blur\')" todo-focus="todo == editedTodo"></form></li></ul></section><footer id="footer" ng-show="todos.length" ng-cloak=""><span id="todo-count"><strong>{{remainingCount}}</strong><ng-pluralize count="remainingCount" when="{ one: \'item left\', other: \'items left\' }"></ng-pluralize></span><ul id="filters"><li><a ng-class="{selected: status == \'\'}" href="#/">All</a></li><li><a ng-class="{selected: status == \'active\'}" href="#/active">Active</a></li><li><a ng-class="{selected: status == \'completed\'}" href="#/completed">Completed</a></li></ul><button id="clear-completed" ng-click="clearCompletedTodos()" ng-show="completedCount">Clear completed ({{completedCount}})</button></footer></section><footer id="info"><p>Double-click to edit a todo</p><p>Credits: <a href="http://twitter.com/cburgdorf">Christoph Burgdorf</a>, <a href="http://ericbidelman.com">Eric Bidelman</a>, <a href="http://jacobmumm.com">Jacob Mumm</a> and <a href="http://igorminar.com">Igor Minar</a></p><p>Part of <a href="http://todomvc.com">TodoMVC</a></p></footer>')}]);